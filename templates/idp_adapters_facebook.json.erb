<%# This is a complex adapter. The "right" way to configure it is
    GET idp/adapters/descriptors/com.pingidentity.adapters.idp.facebook.FacebookAuthenticationAdapter
    and configure the following based on it. For now, just use what we have from our initial example
    and circle back later as needed. -%>
{
  "id": "facebook",<%# just hardcode it %>
  "name": "Facebook", 
  "attributeMapping": {
    "attributeContractFulfillment": {
<% if scope.function_versioncmp([@b['package_ensure'], '2.0']) < 0 -%>
      "about": {
	"source": {
	  "type": "ADAPTER"
	}, 
	"value": "about"
      }, 
      "birthday": {
	"source": {
	  "type": "ADAPTER"
	}, 
	"value": "birthday"
      }, 
      "bio": {
	"source": {
	  "type": "ADAPTER"
	}, 
	"value": "bio"
      }, 
      "education": {
	"source": {
	  "type": "ADAPTER"
	}, 
	"value": "education"
      }, 
      "hometown": {
	"source": {
	  "type": "ADAPTER"
	}, 
	"value": "hometown"
      }, 
      "location": {
	"source": {
	  "type": "ADAPTER"
	}, 
	"value": "location"
      }, 
      "quotes": {
	"source": {
	  "type": "ADAPTER"
	}, 
	"value": "quotes"
      }, 
      "work": {
	"source": {
	  "type": "ADAPTER"
	}, 
	"value": "work"
      }, 
<% else -%>
      "age_range": {
	"source": {
	  "type": "ADAPTER"
	}, 
	"value": "age_range"
      }, 
      "cover": {
	"source": {
	  "type": "ADAPTER"
	}, 
	"value": "cover"
      }, 
      "picture": {
	"source": {
	  "type": "ADAPTER"
	}, 
	"value": "picture"
      }, 
<% end -%>
      "last_name": {
	"source": {
	  "type": "ADAPTER"
	}, 
	"value": "last_name"
      }, 
      "verified": {
	"source": {
	  "type": "ADAPTER"
	}, 
	"value": "verified"
      }, 
      "name": {
	"source": {
	  "type": "ADAPTER"
	}, 
	"value": "name"
      }, 
      "access_token": {
	"source": {
	  "type": "ADAPTER"
	}, 
	"value": "access_token"
      }, 
      "locale": {
	"source": {
	  "type": "ADAPTER"
	}, 
	"value": "locale"
      }, 
      "first_name": {
	"source": {
	  "type": "ADAPTER"
	}, 
	"value": "first_name"
      }, 
      "updated_time": {
	"source": {
	  "type": "ADAPTER"
	}, 
	"value": "updated_time"
      }, 
      "link": {
	"source": {
	  "type": "ADAPTER"
	}, 
	"value": "link"
      }, 
      "email": {
	"source": {
	  "type": "ADAPTER"
	}, 
	"value": "email"
      }, 
      "gender": {
	"source": {
	  "type": "ADAPTER"
	}, 
	"value": "gender"
      }, 
      "timezone": {
	"source": {
	  "type": "ADAPTER"
	}, 
	"value": "timezone"
      }, 
      "id": {
	"source": {
	  "type": "ADAPTER"
	}, 
	"value": "id"
      }, 
      "token_expires": {
	"source": {
	  "type": "ADAPTER"
	}, 
	"value": "token_expires"
      }
    } 
  }, 
  "attributeContract": {
    "coreAttributes": [
<%# some core attributes are changed between 1.x and 2.x -%>
<%# https://docs.pingidentity.com/bundle/fbcic20_sm_facebookCloudIdentityConnector/page/fbcic_c_adapterCoreAttribute.html#fbcic_adapterCoreAttribute -%>
<% if scope.function_versioncmp([@b['package_ensure'], '2.0']) < 0 -%>
      {
	"pseudonym": false, 
	"name": "about", 
	"masked": false
      }, 
      {
	"pseudonym": false, 
	"name": "birthday", 
	"masked": false
      }, 
      {
	"pseudonym": false, 
	"name": "bio", 
	"masked": false
      }, 
      {
	"pseudonym": false, 
	"name": "education", 
	"masked": false
      }, 
      {
	"pseudonym": false, 
	"name": "hometown", 
	"masked": false
      }, 
      {
	"pseudonym": false, 
	"name": "location", 
	"masked": false
      }, 
      {
	"pseudonym": false, 
	"name": "quotes", 
	"masked": false
      }, 
      {
	"pseudonym": false, 
	"name": "work", 
	"masked": false
      }, 
<% else -%>
      {
	"pseudonym": false, 
	"name": "age_range", 
	"masked": false
      }, 
      {
	"pseudonym": false, 
	"name": "cover", 
	"masked": false
      }, 
      {
	"pseudonym": false, 
	"name": "picture", 
	"masked": false
      }, 
<% end -%>
      {
	"pseudonym": false, 
	"name": "updated_time", 
	"masked": false
      }, 
      {
	"pseudonym": false, 
	"name": "gender", 
	"masked": false
      }, 
      {
	"pseudonym": false, 
	"name": "timezone", 
	"masked": false
      }, 
      {
	"pseudonym": false, 
	"name": "link", 
	"masked": false
      }, 
      {
	"pseudonym": false, 
	"name": "verified", 
	"masked": false
      }, 
      {
	"pseudonym": false, 
	"name": "last_name", 
	"masked": false
      }, 
      {
	"pseudonym": false, 
	"name": "locale", 
	"masked": false
      }, 
      {
	"pseudonym": false, 
	"name": "token_expires", 
	"masked": false
      }, 
      {
	"pseudonym": false, 
	"name": "access_token", 
	"masked": false
      }, 
      {
	"pseudonym": true, 
	"name": "name", 
	"masked": false
      }, 
      {
	"pseudonym": false, 
	"name": "id", 
	"masked": false
      }, 
      {
	"pseudonym": false, 
	"name": "first_name", 
	"masked": false
      }
    ], 
    "maskOgnlValues": false, 
    "extendedAttributes": [
      {
	"pseudonym": false, 
	"name": "email", 
	"masked": false
      }
    ]
  }, 
  "pluginDescriptorRef": {
    "id": "com.pingidentity.adapters.idp.facebook.FacebookAuthenticationAdapter", 
    "location": "<%= @adm_api_baseurl-%>/idp/adapters/descriptors/com.pingidentity.adapters.idp.facebook.FacebookAuthenticationAdapter"
  }, 
  "configuration": {
    "tables": [
      {
<% if scope.function_versioncmp([@b['package_ensure'], '2.0']) >= 0 -%>
        "rows": [],
<% else -%>
	"rows": [
	  {
	    "fields": [
	      {
		"name": "Facebook Scope Permission", 
		"value": "email"
	      }, 
	      {
		"name": "Additional Facebook Scope Permission", 
		"value": ""
	      }
	    ]
	  }
	], 
<% end -%>
	"name": "Scope Permissions"
      }
    ], 
    "fields": [
      {
	"name": "Application ID", 
	"value": "<%= @b['app_id'] -%>"
      }, 
      {
	"name": "Application Secret", 
	"value": "<%= @b['app_secret'] -%>"
      }, 
      {
	"name": "Site URL", 
	"value": "<%= @service_api_baseurl -%>/ext/facebook-authn"
      }, 
      {
	"name": "Error Redirect URL", 
	"value": ""
      }, 
      {
	"name": "Logout URL", 
	"value": "https://www.facebook.com/logout.php"
      }, 
      {
	"name": "Unauthorized Redirect URL", 
	"value": ""
      }, 
      {
	"name": "Facebook Authentication URL", 
	"value": "https://www.facebook.com/dialog/oauth"
      }, 
      {
	"name": "Facebook Access Token URL", 
	"value": "https://graph.facebook.com/oauth/access_token"
      }, 
      {
	"name": "Facebook User Data URL", 
<% if scope.function_versioncmp([@b['package_ensure'], '2.0']) >= 0 -%>
	"value": "https://graph.facebook.com/me"
<% else -%>
	"value": "https://graph.facebook.com/v2.2/me"
<% end -%>
      }
    ]
  }
}
